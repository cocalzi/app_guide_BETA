(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function o(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=o(n);fetch(n.href,r)}})();let a=h(),l=L();const y=document.querySelector(".data-table");v(a);console.log(a);let p=document.getElementById("insertBtn"),I=document.getElementById("clearBtn");p?.addEventListener("click",b);async function b(){const e=document.getElementById("name"),t=document.getElementById("km"),o=e?.value,i=t?.valueAsNumber?t?.valueAsNumber:0;if(console.log(o),console.log(i),o===""||i===0){alert("Non lasciare campi vuoti ed inserisci valori validi");return}const r=new Date().toLocaleDateString("it-IT"),d=new Intl.DateTimeFormat("it-IT",{hour:"2-digit",minute:"2-digit",hour12:!1}).format(new Date),s=await T(),c=s[0],f=s[1];let m={id:l,name:o,km:i,date:r,time:d,position:c,fullPositionInfo:f};a.push(m),S(m),u(a),l++,g(l),console.log(a),E()}I?.addEventListener("click",w);function w(){if(!window.confirm("Cancellare tutte le guide in memoria?"))return;l=0,g(l),a=[],u(a);const t=document.querySelector("tbody").children;for(let o=t.length-1;o>=0;o--)t[o].remove()}function h(){const e=localStorage.getItem("myTabRows");return e?JSON.parse(e):[]}function u(e){localStorage.setItem("myTabRows",JSON.stringify(e))}function v(e){const t=document.getElementById("tbody");e.forEach(o=>{const i=`<tr id="row-${o.id}">
                        <td scope="row">${o.date}</td>
                        <td scope="row">${o.time}</td>
                        <td scope="row">${o.km}</td>
                        <td scope="row">${o.name}</td>
                        <td class="location"><a data-id="${o.id}" href = #>${o.position}</a></td>
                        <td><button class="delete-btn" data-id="${o.id}">-</button></td>        
                    </tr>`;t.insertAdjacentHTML("beforeend",i)})}function S(e){const t=`<tr id=row-${e.id}>
                        <td>${e.date}</td>
                        <td>${e.time}</td>
                        <td>${e.km}</td>
                        <td>${e.name}</td>
                        <td class="location"><a data-id="${e.id}" href = #>${e.position}</a></td>
                        <td><button class="delete-btn" data-id="${e.id}">-</button></td>        
                    </tr>`;document.getElementById("tbody").insertAdjacentHTML("beforeend",t)}y.addEventListener("click",function(e){const t=e.target;if(t.classList.contains("delete-btn")){const i=Number(t.dataset.id);console.log("idToDelete: "+i),a=a.filter(r=>r.id!==i),console.log(a),u(a);const n=document.getElementById(`row-${i}`);n&&(n.classList.add("deleting-row"),n.onanimationend=()=>{n.remove()})}if(t.closest(".location")){const i=Number(t.dataset.id);alert(a[i].fullPositionInfo);return}});function L(){return localStorage.getItem("myIndex")===null?0:Number(localStorage.getItem("myIndex"))}function g(e){localStorage.setItem("myIndex",String(e))}function E(){const e=document.getElementById("name"),t=document.getElementById("km"),o=document.getElementById("rememberName"),i=document.getElementById("rememberKm");o.checked||(e.value=""),i.checked||(t.value="")}const $=()=>{const e=document.getElementById("loadingString");return e.textContent="Recupero posizione...",new Promise((t,o)=>{navigator.geolocation.getCurrentPosition(i=>t(i.coords),i=>o(i),{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})})};async function T(){O();let e=["",""];try{console.log("Richiesta posizione in corso...");const t=await $();console.log("Posizione ottenuta:"),console.log(`Lat: ${t.latitude}, Lon: ${t.longitude}`),e=await B(String(t.latitude),String(t.longitude))}catch(t){console.error("Errore nel recupero posizione:",t.message),e=["",""]}finally{N();const t=document.getElementById("loadingString");t.textContent=""}return e}async function B(e,t){const o=document.getElementById("loadingString");o.textContent="Conversione coordinate...";const i=`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${t}`;let n="--",r="--",d="--";try{const c=await(await fetch(i)).json();console.log(c),n=c.address.village||c.address.town||c.address.city,r=c.address["ISO3166-2-lvl6"].slice(3)||"--",d=c.display_name}catch(s){console.log(s)}return[`${n} (${r})`,d]}function O(){document.getElementById("loaderOverlay").classList.remove("hidden")}function N(){document.getElementById("loaderOverlay").classList.add("hidden")}
