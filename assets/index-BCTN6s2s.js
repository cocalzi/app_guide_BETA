(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function o(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=o(n);fetch(n.href,i)}})();let a=h(),l=E();const y=document.querySelector(".data-table");v(a);console.log(a);let p=document.getElementById("insertBtn"),b=document.getElementById("clearBtn");p?.addEventListener("click",w);async function w(){const e=document.getElementById("name"),t=document.getElementById("km"),o=e?.value,r=t?.valueAsNumber?t?.valueAsNumber:0;if(console.log(o),console.log(r),o===""||r===0){alert("Non lasciare campi vuoti ed inserisci valori validi");return}const i=new Date().toLocaleDateString("it-IT"),s=new Intl.DateTimeFormat("it-IT",{hour:"2-digit",minute:"2-digit",hour12:!1}).format(new Date),c=await T(),d=c[0],f=c[1];let m={id:l,name:o,km:r,date:i,time:s,position:d,fullPositionInfo:f};a.push(m),S(m),u(a),l++,g(l),console.log(a),L()}b?.addEventListener("click",I);function I(){if(!window.confirm("Cancellare tutte le guide in memoria?"))return;l=0,g(l),a=[],u(a);const t=document.querySelector("tbody").children;for(let o=t.length-1;o>=0;o--)t[o].remove()}function h(){const e=localStorage.getItem("myTabRows");return e?JSON.parse(e):[]}function u(e){localStorage.setItem("myTabRows",JSON.stringify(e))}function v(e){const t=document.getElementById("tbody");e.forEach(o=>{const r=`<tr id="row-${o.id}">
                        <td scope="row">${o.date}</td>
                        <td scope="row">${o.time}</td>
                        <td scope="row">${o.km}</td>
                        <td scope="row">${o.name}</td>
                        <td class="location" data-id="${o.id}"><a href = #>${o.position}</a></td>
                        <td><button class="delete-btn" data-id="${o.id}"><span class="material-symbols-outlined">delete_sweep</span></button></td>        
                    </tr>`;t.insertAdjacentHTML("beforeend",r)})}function S(e){const t=`<tr id=row-${e.id}>
                        <td>${e.date}</td>
                        <td>${e.time}</td>
                        <td>${e.km}</td>
                        <td>${e.name}</td>
                        <td class="location" data-id="${e.id}"><a href = #>${e.position}</a></td>
                        <td><button class="delete-btn" data-id="${e.id}"><span class="material-symbols-outlined">delete_sweep</span></button></td>        
                    </tr>`;document.getElementById("tbody").insertAdjacentHTML("beforeend",t)}y.addEventListener("click",function(e){const t=e.target;if(console.log(t),t.closest(".delete-btn")?.classList.contains("delete-btn")){const r=t.closest(".delete-btn"),n=Number(r.dataset.id);console.log("idToDelete: "+n),console.log(r),a=a.filter(s=>s.id!==n),console.log(a),u(a);const i=document.getElementById(`row-${n}`);if(i){i.classList.add("deleting-row"),i.onanimationend=()=>{i.remove(),console.log(a)};return}}const o=t.closest(".location");if(console.log(o),o){const r=Number(o.dataset.id);console.log(r);const n=a.find(i=>i.id===r);console.log(n),alert(n.fullPositionInfo);return}});function E(){return localStorage.getItem("myIndex")===null?0:Number(localStorage.getItem("myIndex"))}function g(e){localStorage.setItem("myIndex",String(e))}function L(){const e=document.getElementById("name"),t=document.getElementById("km"),o=document.getElementById("rememberName"),r=document.getElementById("rememberKm");o.checked||(e.value=""),r.checked||(t.value="")}const $=()=>{const e=document.getElementById("loadingString");return e.textContent="Recupero posizione...",new Promise((t,o)=>{navigator.geolocation.getCurrentPosition(r=>t(r.coords),r=>o(r),{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})})};async function T(){O();let e=["",""];try{console.log("Richiesta posizione in corso...");const t=await $();console.log("Posizione ottenuta:"),console.log(`Lat: ${t.latitude}, Lon: ${t.longitude}`),e=await B(String(t.latitude),String(t.longitude))}catch(t){console.error("Errore nel recupero posizione:",t.message),e=["",""]}finally{N();const t=document.getElementById("loadingString");t.textContent=""}return e}async function B(e,t){const o=document.getElementById("loadingString");o.textContent="Conversione coordinate...";const r=`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${t}`;let n="--",i="--",s="--";try{const d=await(await fetch(r)).json();console.log(d),n=d.address.village||d.address.town||d.address.city,i=d.address["ISO3166-2-lvl6"].slice(3)||"--",s=d.display_name}catch(c){console.log(c)}return[`${n} (${i})`,s]}function O(){document.getElementById("loaderOverlay").classList.remove("hidden")}function N(){document.getElementById("loaderOverlay").classList.add("hidden")}
